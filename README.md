# Gilbert 21 universal
Gilbert 21 universal is a progressive web app (PWA) and successor to the [Gilbert 21 Android app](https://github.com/burkmarr/G21App). The Android app has not been developed for some time and is no longer functional on recent releases of Android.

This app uses [PWA technology](https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps) to provide practically the same functionality as the old Android app but with the advantage that it is easier to develop and deploy. It also has the potential to be used on devices other than those running Android (e.g. iPhone).

The files generated by this app have the same format as those produced by the previous Android app and can therefore be used with the [Gilbert 21 desktop application](https://github.com/burkmarr/Gilbert21) in exactly the same way.

Further development of this G21 PWA will concentrate on replacing some of the functionality of the desktop app so that all the work required to produce CSVs of biological records suitable for upload into applications such as [iRecord](https://irecord.org.uk/) can be done within this one app which runs both on mobile and desktop devices. Thus it is envisaged that *Gilbert 21 universal* will eventually replace the Giblert 21 desktop application, just as it has done the Android app.

## Installing the app on your phone
To install this app, open the browser on your phone when you have an internet connection and navigate to this URL:
https://burkmarr.github.io/g21u

As a PWA the app will cache all of the resources it needs to run offiline when you first open it. So you will be able to use it in the field even when you have no internet connection just by navigating to this URL in your browser. But another PWA feature is that you can install the app to your phone so that it's icon appears on your homescreen just like any other app. When you've done that, you can start the app just by tapping the icon and although, it is opened by a browser under the hood, it will look more like a native app without the usual browser controls.

If you are using Chrome on Android, click the three dots in the top right of the browser and look for the **Add to Home Screen** link. When you click that, you should be offered the option to install to your phone. There are similar features on both Safari and Chrome on iOS.

## Permission to use location and microphone
Different browsers and operating systems handle permission requests differently, but if you are prompted for permission to use the microphone and the location (GPS) services, you need to confirm permission to use them in order for the app to work properly.

On iOS you may need to go to security and permissions to enable location services and microphone use on the browser you are using. I have found that browsers on iOS repeatedly ask for permission to use the microphone whenever the recording page is navigated to and the microphone used for the first time. On Android you only need to give permission once and it is remembered.

## Using the app
Although the app should be easy to understand intuitively, there follow some instructions. In particuar, there are several ways in which the sound files it produces might be exported to your desktop environment (e.g. for use with the Gilbert 21 desktop).

The app has three screens, each of which is covered below.

## Issues
If you use this app and find any problems or want to share information that may help other users use it on particular devices, browsers or operating systems, please use the *GitHub Issues* associated with this repository to open a new issue.

### The main recording screen
The main recording screen is the default that opens when you first visit the app. It can also be reached by tapping the small microphone icon on the bottom navigation bar.

On the main recording screen there are two large image icons - a bin and a microphone. Until your device obtains a position from the GPS, the microphone will appear grey and you will not be able to record anything. When a position is obtained, it will go green and you will be able to record. (Note that every time a new position is obtained from the GPS, the smaller location icon flashes green.)

When you tap the green microphone, after any permissions are requested and granted, the microphone turns red and flashes - you are now recording. To finish and save the recording, tap again on the red microphone. To delete a recording without saving it, tap on the bin (which turns orange when recording is in progress).

See the section on the options screen (storage), to understand what happens to the recorded WAV file when you finish recording.

### The options screen
The options screen can be reached by tapping the small gear icon on the bottom navigation bar. The options are described below.

#### Filename format
You can select either of these two values:
- OSGR
- Lat/lon

The former uses an OS grid reference in the name of the WAV file and the latter uses the lat/lon in the filename. Both are compatible with Gilbert 21 desktop.

#### Automatic playback
If this toggle is on, a recording is played back immediately upon completion. (On iPhone the playback may occur after you've dealt with a download dialog if you have the 'immediate download' storage option set -see below.) This can help you judge, in the field, if a recording has been successful, e.g. in windy conditions.

#### Playback volume
This indicates the volume that recordings should be played back at. (The actual volume may also depend on the overall volume you have your phone set to.) 

#### Sounds signal volume
This indicates the volume used for sounds signals which are emitted, for example, when you start and end (or delete) a recording on the recording screen. For no sound, turn this right down.

#### Storage
This option determines how recorded WAV files are handled. 

If set to *private origin file system*, created files are stored in a file system on your device that is visible only to the G21 app (you won't be able to find the files with a file browser). The advantage of doing this is that you can use the *manage recordings* screen to review, playback and, if necessary, delete recordings. (You will also be able to export and download the files from there - see below for further details.)

Unfortunately the *private origin file system* has not worked properly on iPhone when I've tested it (the files are created in the file system but they are zero bytes). Until a fix for this can be found, you will need to use the next option if you are using iPhone.

If set to *immediate download*, files are downloaded to your device from the browser immediately on creation. In Chrome on Android this happens immediately but on iOS you will likely be presented with a download dialog.

If you use the *immediate download* option, you will need to devise a workflow for moving your WAV files to where you want them, e.g. by using a file manager that allows you to share them, e.g. by email or by sending to cloud storage such as Google Drive.

### The manage recordings screen
The manage recordings screen can be reached by tapping the small list icon on the bottom navigation bar. 

This screen lists all recordings you have made and saved using the *private origin file system* storage option. Recordings made using the *immediate download* storage option do not appear hear.

You can play back recordings by tapping on the green speaker icon on the relevant record item. Whist playing back, the icon turns red and flashes. If you tap on the red speaker, it stops the playback and turns green again.

You can select or deselect recordings indivdually by tapping the checkboxes on the right on the record item. Or you can select/deselect them all at once using the two icons on the right of the top toolbar.

Selected icons can be deleted, downloaded or shared using the three icons on the left of the top toolbar. Sharing items invokes your browser's standard share dialog. I have found this a great way to easily transfer recordings to Google Drive from where I can access them on my desktop.