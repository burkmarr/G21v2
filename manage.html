<!doctype  html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>G21v2 manage</title>
  <link rel="stylesheet" href="css/general.css">
  <link rel="stylesheet" href="css/navigation.css">
  <link rel="stylesheet" href="css/manage.css">
  <link rel="stylesheet" href="css/taxon-select.css">
  <link rel="manifest" href="manifest.json" />
</head>

<body id="manage">

  <dialog id="delete-confirm-dialog" align="end">
    <p>Are you sure that you want to delete <span id="file-num"></span> <span id="file-text"></span>?</p>
    <button id="delete-reject">No</button>
    <button id="delete-confirm">Yes</button>
  </dialog>

  <dialog id="share-not-supported" >
    <p>
      This broweser - <span id='agent'></span> - does not support the web share API. Consider 
      using a browser that does, e.g. Chrome.
    </p>
    <form method="dialog"><button>OK</button></form>
  </dialog>

  <div id="navtop" style="display: flex"></div>
  </div>
  <div id="manage-div" style="display: flex">
    <div id="record-list"></div>
    <div id="record-field-details">
      <div id="record-details" class="details-div"></div>
      <div id="taxa-details" class="details-div"></div>
      <div id="metadata-details" class="details-div"></div>
    </div>
  </div>
  <div id="navbot"></div>

  <script type="module" defer>
    import { navbot } from './js/navbot.js'
    import { navtop } from './js/navtop.js'
    import { downloadChecked, shareChecked, deleteChecked, uncheckAll, 
      checkAll, deleteYesNo, initialiseList
    } from './js/record-list.js'
    import { generateRecordFields, populateRecordFields, editNavigation } from './js/record-details.js'
    import { getOpt, getSs, setSs } from './js/common.js'

    // Add class to body if emulating v1
    if (getOpt('emulate-v1') === 'true') {
      document.body.classList.add('emulate-v1')
    }
    // Add class to body if small screen edit page
    if (getSs('mainNav') === 'navbot-link-edit') { 
      document.body.classList.add('small-edit')
    }
 
    // Add event handlers
    document.getElementById('delete-reject').addEventListener('click', deleteYesNo)
    document.getElementById('delete-confirm').addEventListener('click', deleteYesNo)
    
    //document.getElementById('tab-button-record-details').addEventListener('click', openTab)
    //document.getElementById('tab-button-field-details').addEventListener('click', openTab)

    // Top navigation
    navtop()
    // Main navigation (bottom)
    navbot()

    // Record list
    await initialiseList()

    // Record fields
    generateRecordFields()
    await populateRecordFields()

    // Manage screen layout depending on:
    const smallScreen = window.matchMedia("(max-width: 1024px)")
    smallScreen.addEventListener("change", function() {
      screenLayout()
    })
    function screenLayout () {
      // On screen size change
      if (getSs('mainNav') === 'navbot-link-edit' && !smallScreen.matches) {
        if (getSs('topNav') === 'edit-record') {
          // If topnav edit was previously selected on small screen 
          // reset to nothing so that the appriate default is selected
          // for large screen.
          setSs('topNav', '')
        }
        // If edit was selected on small screen, select manage on large
        // Dispatch click event on the link
        // This is necessary as click() method may not on div element on some browsers
        document.getElementById('navbot-link-manage').dispatchEvent(
          new MouseEvent('click', { 
            bubbles: true, 
            cancelable: true, 
            view: window 
          })
        )
      }
    }

    editNavigation()

    // Request persistent storage
    // Some diagnostics on options page indicate 
    // whether or not has been granted.
    const persist = await navigator.storage.persist()
  </script>
</body>
</html>